<!DOCTYPE html>
<html>
<head>
    <title>Hypso OpenMCT</title>
    <script src="openmct/openmct.js"></script>
    <script src="plugins/ServerPlugin.js"></script>
</head>
<body>
    <script>
        function fetchConfig(callback) {
            fetch("/config")
            .then(response => response.json())
            .then(json => callback(null, json))
            .catch(error => callback(error, null));
        }

        function startOpenMct(config) {
            openmct.setAssetPath('openmct');
            openmct.install(openmct.plugins.LocalStorage());
            openmct.install(openmct.plugins.MyItems());
            openmct.install(openmct.plugins.UTCTimeSystem());
            openmct.time.clock('local', {start: -15 * 60 * 1000, end: 0});
            openmct.time.timeSystem('utc');
            openmct.install(openmct.plugins.Espresso());

            let serverPlugin = new ServerPlugin(config, config.metadata, openmct);

            openmct.install(serverPlugin.installer);

            openmct.start();
        }

        fetchConfig((error, config) => {
            if (error) {
                console.log(error);
            } else {
                console.log(config);
                startOpenMct(config);
            }
        });
    </script>
</body>
</html>
